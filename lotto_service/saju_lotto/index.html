<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ€ ì•¼ì˜¹ì‹  ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œê¸°</title>

  <style>
    :root{
      /* LIGHT MODE COLORS */
      --bg1:#f6f2e7;
      --bg2:#efe7d6;
      --card:#ffffffcc;
      --stroke:rgba(24, 32, 48, .12);
      --shadow: 0 20px 60px rgba(15, 23, 42, 0.18);
      --text:#142033;
      --sub: rgba(20, 32, 51, .68);

      --mint:#b9ce89;
      --mint2:#5ca95b;
      --butter:#e8c572;
      --pink:#f7a3b0;

      --btn1:#22c55e;
      --btn2:#16a34a;
      
      --gold: #fbbf24;
      --silver: #94a3b8;
      --bronze: #b45309;

      --radius: 26px;
    }

    /* DARK MODE COLORS */
    body.dark-mode {
      --bg1: #1a0b14;   
      --bg2: #2d1b2e;   
      --card: rgba(45, 27, 46, 0.75);
      --stroke: rgba(255, 200, 200, 0.15);
      --shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      --text: #eaddcf;  
      --sub: rgba(234, 221, 207, 0.6);

      --mint: #d946ef;  
      --mint2: #a21caf; 
      --butter: #f59e0b; 
      --pink: #be123c;   
      
      --btn1: #db2777; 
      --btn2: #9d174d;
      
      --gold: #f59e0b;
    }

    *{
      box-sizing:border-box;
    }
    html,body{
      height:100%;
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 20%, rgba(92,169,91,.15), transparent 55%),
        radial-gradient(900px 500px at 85% 30%, rgba(232,197,114,.15), transparent 55%),
        radial-gradient(900px 500px at 50% 95%, rgba(247,163,176,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
      transition: background 0.5s ease, color 0.5s ease;
    }
    
    body.dark-mode {
        background:
        radial-gradient(1200px 600px at 20% 20%, rgba(162, 28, 175, 0.15), transparent 55%),
        radial-gradient(900px 500px at 80% 80%, rgba(190, 18, 60, 0.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .bg-bubbles{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.55;
    }
    .bubble{
      position:absolute;
      width: 180px;
      height: 180px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.7), rgba(255,255,255,.15));
      border: 1px solid rgba(255,255,255,.5);
      box-shadow: 0 18px 45px rgba(20,32,51,.08);
      animation: floaty 10s ease-in-out infinite;
    }
    body.dark-mode .bubble {
      background: radial-gradient(circle at 30% 30%, rgba(255, 100, 150, .15), rgba(100, 0, 50, .05));
      border: 1px solid rgba(255, 100, 150, .1);
      box-shadow: 0 18px 45px rgba(0,0,0,.4);
    }
    .bubble.b1{
      left:-40px;
      top:18%;
      width:220px;
      height:220px;
      animation-duration: 12s;
    }
    .bubble.b2{
      right:-60px;
      top:8%;
      width:260px;
      height:260px;
      animation-duration: 14s;
    }
    .bubble.b3{
      left:12%;
      bottom:-80px;
      width:240px;
      height:240px;
      animation-duration: 16s;
    }
    .bubble.b4{
      right:18%;
      bottom:-120px;
      width:300px;
      height:300px;
      animation-duration: 18s;
    }
    @keyframes floaty{
      0%,100%{
        transform: translateY(0) translateX(0) scale(1);
      }
      50%{
        transform: translateY(-18px) translateX(12px) scale(1.02);
      }
    }

    .wrap{
      position:relative;
      z-index:1;
      width:min(1060px, 92vw);
      margin: clamp(18px, 4vw, 36px) auto;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
    }
    @media (max-width: 940px){
      .wrap{
        grid-template-columns: 1fr;
      }
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
      transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(240px 240px at 20% 20%, rgba(185,206,137,.35), transparent 62%),
        radial-gradient(220px 220px at 80% 10%, rgba(232,197,114,.26), transparent 60%),
        radial-gradient(220px 220px at 85% 85%, rgba(247,163,176,.22), transparent 62%);
      pointer-events:none;
      z-index:0;
      transition: opacity 0.3s;
    }
    body.dark-mode .panel::before {
       opacity: 0.3;
       background:
        radial-gradient(240px 240px at 20% 20%, rgba(219, 39, 119, .2), transparent 62%),
        radial-gradient(220px 220px at 80% 10%, rgba(147, 51, 234, .15), transparent 60%);
    }
    .panel > *{
      position:relative;
      z-index:1;
    }

    .left{
      padding: 22px 22px 18px;
    }

    .title-row{
      display: block;
      margin-bottom: 12px;
    }
    .title-row::after {
      content: "";
      display: table;
      clear: both;
    }

    h1{
      margin:0;
      font-size: clamp(20px, 2.2vw, 28px);
      letter-spacing: -0.5px;
      line-height:1.2;
      transition: color 0.3s;
      padding-top: 4px;
    }
    body.dark-mode h1 {
      text-shadow: 0 0 20px rgba(219, 39, 119, 0.5);
    }
    
    .subtitle{
      margin:8px 0 0;
      color:var(--sub);
      font-size: 14px;
      line-height:1.5;
      word-break: keep-all;
      clear: left;
    }
    .header-actions {
      float: right;
      display: flex;
      gap: 8px;
      margin-left: 12px;
      margin-bottom: 4px;
    }

    .badge{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      box-shadow: 0 10px 22px rgba(20,32,51,.08);
      white-space:nowrap;
      user-select:none;
      transition: background 0.3s, box-shadow 0.3s;
    }
    body.dark-mode .badge {
      background: rgba(30, 20, 30, 0.6);
      box-shadow: 0 10px 22px rgba(0,0,0,.3);
      border-color: rgba(219, 39, 119, 0.3);
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background: linear-gradient(135deg, var(--btn1), var(--btn2));
      box-shadow: 0 0 0 4px rgba(34,197,94,.18);
    }
    body.dark-mode .dot {
      box-shadow: 0 0 0 4px rgba(219, 39, 119, 0.2);
    }
    .badge span{
      font-size: 12px;
      color: var(--sub);
      font-weight:900;
    }

    .theme-btn {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: 1px solid var(--stroke);
        background: var(--card);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
        font-size: 20px;
        transition: transform 0.2s, background 0.2s;
    }
    body.dark-mode .theme-btn {
      background: rgba(255,255,255,0.05);
      color: #fbbf24;
    }
    .theme-btn:hover {
      transform: scale(1.1);
    }
    .theme-btn:active {
      transform: scale(0.95);
    }

    /* FORM & INPUTS */
    .form{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .form{
        grid-template-columns: 1fr;
      }
    }
    
    .field{
      background: rgba(255,255,255,.58);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 10px 22px rgba(20,32,51,.06);
    }
    body.dark-mode .field {
      background: rgba(10, 5, 10, 0.3);
      box-shadow: 0 10px 22px rgba(0,0,0,.2);
    }

    .field label{
      display:block;
      font-size: 12px;
      color: var(--sub);
      font-weight: 900;
      margin-bottom: 6px;
      letter-spacing:-0.2px;
    }
    .field input, .field select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      font-size: 14px;
      color: var(--text);
      font-weight: 800;
      font-family:inherit;
    }
    .field select {
      cursor: pointer;
    }
    body.dark-mode input[type="date"] {
      color-scheme: dark;
    }
    body.dark-mode select {
      color: var(--text);
    }
    body.dark-mode select option {
      background: #1a0b14;
      color: #fff;
    }

    .field small{
      display:block;
      margin-top: 6px;
      font-size: 11px;
      color: var(--sub);
      opacity: 0.8;
      line-height:1.25;
    }

    .controls{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    button{
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      cursor:pointer;
      font-weight: 950;
      transition: transform .12s ease, filter .14s ease, opacity .14s ease;
      user-select:none;
      display:flex;
      align-items:center;
      gap:10px;
      letter-spacing:-0.2px;
    }
    button:active{
      transform: translateY(1px) scale(.99);
    }
    button:hover{
      filter: brightness(1.02);
    }

    .btn-main{
      background: linear-gradient(135deg, var(--btn1), var(--btn2));
      color: #062012;
      box-shadow: 0 14px 28px rgba(22,163,74,.22);
      flex: 1;
      min-width: 230px;
      position:relative;
      overflow:hidden;
    }
    body.dark-mode .btn-main {
        background: linear-gradient(135deg, #be123c, #831843);
        color: #ffe4e6;
        box-shadow: 0 14px 28px rgba(190, 18, 60, 0.3);
    }
    .btn-main::after{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 40%);
      transform: translateX(-20%);
      opacity:.8;
      pointer-events:none;
    }
    
    .btn-ghost{
      background: rgba(255,255,255,.55);
      border: 1px solid var(--stroke);
      color: var(--text);
      box-shadow: 0 10px 22px rgba(20,32,51,.08);
    }
    body.dark-mode .btn-ghost {
      background: rgba(255,255,255,.05);
      box-shadow: 0 10px 22px rgba(0,0,0,.2);
    }
    
    .btn-icon{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.65);
      border:1px solid var(--stroke);
    }
    body.dark-mode .btn-icon {
      background: rgba(255,255,255,.1);
    }

    /*REPORT CARD */
    .report-card {
        margin-top: 18px;
        background: rgba(255,255,255,0.7);
        border: 1px solid var(--stroke);
        border-radius: 20px;
        padding: 16px;
        display: none;
        flex-direction: column;
        gap: 12px;
        animation: slideDown 0.4s ease-out;
    }
    body.dark-mode .report-card {
      background: rgba(0,0,0,0.3);
      border-color: var(--mint);
    }
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .report-header {
      font-size: 15px;
      font-weight: 900;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--stroke);
      padding-bottom: 8px;
    }
    .report-score {
      background: var(--btn1);
      color: #fff;
      padding: 4px 10px;
      border-radius: 99px;
      font-size: 12px;
      font-weight: 800;
    }
    .report-body {
      font-size: 13px;
      line-height: 1.5;
      color: var(--text);
    }
    .report-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .report-label {
      flex: 0 0 55px;
      font-weight: 800;
      color: var(--sub);
    }
    .report-val {
      flex: 1;
      font-weight: 600;
    }
    
    .saju-desc {
        font-size: 13px;
        color: var(--text);
        margin-top: 6px;
        background: rgba(255,255,255,0.5);
        padding: 10px;
        border-radius: 12px;
        line-height: 1.5;
        border: 1px solid var(--stroke);
    }
    body.dark-mode .saju-desc {
      background: rgba(255,255,255,0.05);
      color: #e2e8f0;
    }
    
    .lucky-ball {
        display: inline-block;
        width: 20px;
        height: 20px;
        line-height: 20px;
        text-align: center;
        background: var(--mint);
        color: #fff;
        border-radius: 50%;
        font-size: 11px;
        margin-left: 4px;
        font-weight: bold;
    }
    
    .meta{
      margin-top: 12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      color: var(--sub);
      font-size: 13px;
    }
    .toast{
      margin-top: 12px;
      min-height: 20px;
      font-size: 13px;
      color: var(--sub);
    }

    /* RIGHT PANEL */
    .right{
      display:flex;
      flex-direction:column;
    }
    .hero{
      padding: 18px 18px 0;
      display:flex;
      align-items:center;
      gap:14px;
    }
    .hero-img{
      width: 108px;
      height: 108px;
      border-radius: 26px;
      overflow:hidden;
      border: 1px solid var(--stroke);
      box-shadow: 0 16px 30px rgba(20,32,51,.14);
      flex: 0 0 auto;
      background: rgba(255,255,255,.65);
      position:relative;
    }
    body.dark-mode .hero-img {
      background: rgba(0,0,0,.2);
      box-shadow: 0 16px 30px rgba(0,0,0,.5);
      border-color: rgba(219, 39, 119, 0.3);
    }
    .hero-img img{
      width:100%;
      height:100%;
      object-fit:cover;
      transform: scale(1.08);
      filter: saturate(1.06) contrast(1.03);
      transition: opacity 0.3s ease;
    }
    .hero-text{
      flex:1;
      min-width:0;
    }
    .hero-text .big{
      font-weight: 1000;
      letter-spacing:-0.6px;
      font-size: 16px;
      margin:0 0 6px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hero-text .small{
      margin:0;
      color: var(--sub);
      font-size: 13px;
      line-height:1.35;
      word-break: keep-all;
    }

    .result{
      padding: 14px 18px 18px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .sort-area {
      display: none;
      justify-content: flex-end;
      gap: 8px;
    }
    .sets{
      display:grid;
      gap: 10px;
      transition: all 0.5s ease;
    }

    .set-card{
      background: rgba(255,255,255,.65);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 12px 12px 10px;
      box-shadow: 0 10px 22px rgba(20,32,51,.08);
      overflow:visible;
      position:relative;
      transition: transform 0.3s ease, border-color 0.3s;
    }
    body.dark-mode .set-card {
      background: rgba(30, 20, 30, 0.4);
      box-shadow: 0 10px 22px rgba(0,0,0,.2);
    }
    .set-card::before{
      content:"";
      position:absolute;
      inset:-30px;
      background: radial-gradient(220px 160px at 10% 10%, rgba(185,206,137,.25), transparent 60%), radial-gradient(200px 140px at 80% 20%, rgba(232,197,114,.18), transparent 60%);
      pointer-events:none;
      border-radius: inherit;
    }
    body.dark-mode .set-card::before {
      opacity: 0.3;
      background: radial-gradient(220px 160px at 10% 10%, rgba(219, 39, 119, .2), transparent 60%);
    }

    /* Rank Styles - Badges */
    .rank-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        padding: 4px 8px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 900;
        color: #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        z-index: 5;
        display: none; 
        animation: popBadge 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .rank-score {
        display: block;
        font-size: 9px;
        opacity: 0.9;
        margin-top: 1px;
        font-weight: 400;
    }
    @keyframes popBadge {
      from {
        transform: scale(0);
      }
      to {
        transform: scale(1);
      }
    }

    .set-card.rank-1 {
      border: 2px solid var(--gold);
      transform: scale(1.02);
      z-index: 2;
    }
    .set-card.rank-1 .rank-badge {
      display: block;
      background: var(--gold);
    }
    
    .set-card.rank-2 {
      border: 1.5px solid var(--silver);
    }
    .set-card.rank-2 .rank-badge {
      display: block;
      background: var(--silver);
    }
    
    .set-card.rank-3 {
      border: 1.5px solid var(--bronze);
    }
    .set-card.rank-3 .rank-badge {
      display: block;
      background: var(--bronze);
    }

    .set-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      position:relative;
      z-index:1;
    }
    .set-label{
      font-weight: 1000;
      letter-spacing:-0.4px;
      font-size: 13px;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.6);
      color: var(--sub);
      font-weight: 950;
    }
    body.dark-mode .pill {
      background: rgba(255,255,255,.1);
    }

    .mini-btn{
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 12px;
      background: rgba(255,255,255,.7);
      border:1px solid var(--stroke);
      color: var(--text);
      box-shadow: 0 8px 14px rgba(20,32,51,.08);
      cursor:pointer;
      font-weight:950;
      display:flex;
      align-items:center;
      gap:8px;
      transition: transform .12s ease, opacity .12s ease;
      text-decoration: none;
    }
    body.dark-mode .mini-btn {
      background: rgba(255,255,255,.1);
      box-shadow: 0 8px 14px rgba(0,0,0,.2);
    }
    .mini-btn:active{
      transform: translateY(1px);
      opacity:.9;
    }

    .balls{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      position:relative;
      z-index:1;
      min-height: 48px;
    }
    .ball{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-weight: 1000;
      letter-spacing:-0.3px;
      color: rgba(11, 18, 32, .92);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.22), 0 10px 18px rgba(15,23,42,.18);
      user-select:none;
      opacity: 0;
      transform: translateY(10px) scale(.92);
      will-change: transform, opacity, filter;
    }
    body.dark-mode .ball {
        box-shadow: inset 0 0 0 1px rgba(255,255,255,.3), 0 5px 15px rgba(0,0,0,.5);
        color: #fff;
        text-shadow: 0 1px 2px rgba(0,0,0,.5);
    }
    .ball.show{
      animation: pop .52s cubic-bezier(.2,.9,.2,1) both;
      animation-delay: var(--d, 0ms);
    }
    @keyframes pop{
      from {
        transform: translateY(10px) scale(.92);
        opacity: 0;
        filter: blur(2px);
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
        filter: blur(0);
      }
    }
    
    .ball.lucky {
      border: 2px solid #fff;
      box-shadow: 0 0 15px var(--mint2);
      z-index: 2;
      transform: scale(1.1);
    }
    body.dark-mode .ball.lucky {
      box-shadow: 0 0 15px #f472b6;
      border-color: #f472b6;
    }

    .r1{
      background: linear-gradient(135deg, #fbbf24, var(--butter));
    }
    .r2{
      background: linear-gradient(135deg, #93c5fd, #60a5fa);
    }
    .r3{
      background: linear-gradient(135deg, #fda4af, var(--pink));
    }
    .r4{
      background: linear-gradient(135deg, #86efac, #34d399);
    }
    .r5{
      background: linear-gradient(135deg, #c4b5fd, #a78bfa);
    }

    body.dark-mode .r1 {
      background: linear-gradient(135deg, #b45309, #d97706);
    } 
    body.dark-mode .r2 {
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
    } 
    body.dark-mode .r3 {
      background: linear-gradient(135deg, #9f1239, #e11d48);
    } 
    body.dark-mode .r4 {
      background: linear-gradient(135deg, #14532d, #16a34a);
    } 
    body.dark-mode .r5 {
      background: linear-gradient(135deg, #581c87, #7c3aed);
    } 

    .spark{
      position:absolute;
      width:10px;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.9);
      pointer-events:none;
      box-shadow: 0 0 0 10px rgba(34,197,94,.12);
      animation: spark .6s ease-out forwards;
      z-index:9999;
    }
    body.dark-mode .spark {
      background: #f472b6;
      box-shadow: 0 0 0 10px rgba(219, 39, 119, .2);
    }
    @keyframes spark{
      from{
        transform: translate(0,0) scale(.9);
        opacity: .9;
      }
      to {
        transform: translate(var(--dx), var(--dy)) scale(0);
        opacity: 0;
      }
    }

    .loading{
      pointer-events:none;
      opacity:.92;
      filter:saturate(1.05);
    }
    .loading .btn-icon{
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .bubble{
        animation:none;
      }
      .ball.show{
        animation:none;
        opacity:1;
        transform:none;
        filter:none;
      }
      button{
        transition:none;
      }
      .loading .btn-icon{
        animation:none;
      }
    }
  </style>
</head>

<body>
  <div class="bg-bubbles" aria-hidden="true">
    <div class="bubble b1"></div>
    <div class="bubble b2"></div>
    <div class="bubble b3"></div>
    <div class="bubble b4"></div>
  </div>

  <main class="wrap">
    <!-- LEFT -->
    <section class="panel left">
      <div class="title-row">
        <div class="header-actions">
          <button class="theme-btn" id="btnTheme" title="ëª¨ë“œ ì „í™˜">ğŸŒ™</button>
          <div class="badge" title="ì£¼ì˜">
            <span class="dot"></span>
            <span id="txtBadge">ì¬ë¯¸ìš©ì´ëƒ¥</span>
          </div>
        </div>

        <h1 id="txtTitle">ğŸ€ ì•¼ì˜¹ì‹  ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ</h1>
        <p class="subtitle" id="txtSub">
          ê°„ë‹¨ ì •ë³´ ë„£ìœ¼ë©´ ê·¸ ê¸°ìš´(?)ìœ¼ë¡œ ë²ˆí˜¸ë¥¼ ë½‘ì•„ì¤€ë‹¤ëƒ¥ ğŸ¾<br/>
          ë‹¹ì‹ ë§Œì„ ìœ„í•œ ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸ë¥¼ í™•ì¸í•´ë³´ë¼ëƒ¥!
        </p>
      </div>

      <!-- ì‚¬ì£¼ ëŠë‚Œ ì…ë ¥ -->
      <div class="form">
        <div class="field">
          <label for="inpName">ì´ë¦„</label>
          <input id="inpName" type="text" placeholder="ì˜ˆ) ì•¼ì˜¹ì´" autocomplete="name"/>
        </div>

        <div class="field">
          <label for="inpBirth">ìƒë…„ì›”ì¼</label>
          <input id="inpBirth" type="date" />
        </div>

        <div class="field">
            <label for="inpTime">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
            <select id="inpTime">
                <option value="">ëª¨ë¦„ / ë¬´ê´€</option>
                <option value="23">ìì‹œ (23:30 ~ 01:29)</option>
                <option value="1">ì¶•ì‹œ (01:30 ~ 03:29)</option>
                <option value="3">ì¸ì‹œ (03:30 ~ 05:29)</option>
                <option value="5">ë¬˜ì‹œ (05:30 ~ 07:29)</option>
                <option value="7">ì§„ì‹œ (07:30 ~ 09:29)</option>
                <option value="9">ì‚¬ì‹œ (09:30 ~ 11:29)</option>
                <option value="11">ì˜¤ì‹œ (11:30 ~ 13:29)</option>
                <option value="13">ë¯¸ì‹œ (13:30 ~ 15:29)</option>
                <option value="15">ì‹ ì‹œ (15:30 ~ 17:29)</option>
                <option value="17">ìœ ì‹œ (17:30 ~ 19:29)</option>
                <option value="19">ìˆ ì‹œ (19:30 ~ 21:29)</option>
                <option value="21">í•´ì‹œ (21:30 ~ 23:29)</option>
            </select>
        </div>

        <div class="field">
          <label for="inpKeyword">ì˜¤ëŠ˜ì˜ í‚¤ì›Œë“œ(ì„ íƒ)</label>
          <input id="inpKeyword" type="text" placeholder="ì˜ˆ) ê¸°ë¶„ ì¢‹ìŒ / ëŒ€ë°•" />
        </div>
      </div>

      <div class="controls">
        <button class="btn-main" id="btnPick">
          <span class="btn-icon">ğŸ²</span>
          <span id="txtBtnPick">ì‚¬ì£¼ ê¸°ìš´ìœ¼ë¡œ ë²ˆí˜¸ ë½‘ê¸°</span>
        </button>

        <button class="btn-ghost" id="btnCopyAll" title="ì „ì²´ ë³µì‚¬">
          <span class="btn-icon">ğŸ“‹</span>
          <span id="txtBtnCopy">ì „ì²´ ë³µì‚¬</span>
        </button>

        <button class="btn-ghost" id="btnReset" title="ì´ˆê¸°í™”">
          <span class="btn-icon">ğŸ§¼</span>
          <span id="txtBtnReset">ì´ˆê¸°í™”</span>
        </button>
      </div>

      <!-- SAJU REPORT CARD -->
      <div class="report-card" id="reportCard">
        <div class="report-header">
           <span id="reportTitle">ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë¶„ì„</span>
           <span class="report-score" id="reportScore">95ì </span>
        </div>
        <div class="report-body">
            <div class="report-row">
                <div class="report-label">ì‚¬ì£¼</div>
                <div class="report-val" id="reportSaju">...</div>
            </div>
            
            <div id="sajuEasyDesc" class="saju-desc"></div>

            <div class="report-row" style="margin-top:10px;">
                <div class="report-label">ì´ìš´</div>
                <div class="report-val" id="reportTotal">...</div>
            </div>
            <div class="report-row">
                <div class="report-label">ê¸ˆì „ìš´</div>
                <div class="report-val" id="reportMoney">...</div>
            </div>
            <div class="report-row">
                <div class="report-label" style="color:var(--mint2)">í–‰ìš´ìˆ˜</div>
                <div class="report-val" id="reportLuckyMsg">
                    ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸ <span class="lucky-ball" id="reportLuckyNum">7</span>
                </div>
            </div>
        </div>
      </div>

      <div class="meta">
        <div id="seedInfo">ê¸°ìš´: ëŒ€ê¸°ì¤‘ì´ëƒ¥</div>
        <div id="stamp">ëŒ€ê¸° ì¤‘</div>
      </div>

      <div class="toast" id="toast">
        ì•„ì§ ë½‘ì€ ë²ˆí˜¸ê°€ ì—†ë‹¤ëƒ¥. ë²„íŠ¼ ëˆŒëŸ¬ë³´ë¼ëƒ¥!
      </div>

    </section>

    <!-- RIGHT -->
    <section class="panel right">
      <div class="hero">
        <div class="hero-img">
          <img id="mascot" alt="ìºë¦­í„°" src="./mascot_bright.png" />
        </div>
        <div class="hero-text">
          <p class="big" id="txtHeroTitle">ì•¼ì˜¹ì‹ ì´ ë½‘ì•„ì¤€ ë²ˆí˜¸ë‹¤ëƒ¥ ğŸ</p>
          <p class="small" id="txtHeroSub">ì„¸íŠ¸ë³„ <b>ë³µì‚¬</b>ë„ ë˜ê³ , <b>ì „ì²´ ë³µì‚¬</b>ë„ ëœë‹¤ëƒ¥!</p>
        </div>
      </div>

      <div class="result">
        <div class="sort-area" id="sortArea">
            <button class="mini-btn" id="btnSort">
                ğŸ† ê¸°ìš´ìˆœ ì •ë ¬ (TOP 5)
            </button>
            <a href="https://www.dhlottery.co.kr/" target="_blank" class="mini-btn" title="ë™í–‰ë³µê¶Œìœ¼ë¡œ ì´ë™">
                ğŸ›’ êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°
            </a>
        </div>
        <div class="sets" id="sets"></div>
      </div>
    </section>
  </main>

  <script>
    const setsEl  = document.getElementById("sets");
    const stampEl = document.getElementById("stamp");
    const toastEl = document.getElementById("toast");
    const seedInfoEl = document.getElementById("seedInfo");
    
    // Report Elements
    const reportCard = document.getElementById("reportCard");
    const reportTotal = document.getElementById("reportTotal");
    const reportMoney = document.getElementById("reportMoney");
    const reportScore = document.getElementById("reportScore");
    const reportLuckyNum = document.getElementById("reportLuckyNum");
    const reportLuckyMsg = document.getElementById("reportLuckyMsg");
    const reportTitle = document.getElementById("reportTitle");
    const reportSaju = document.getElementById("reportSaju");
    const sajuEasyDesc = document.getElementById("sajuEasyDesc");

    const btnPick    = document.getElementById("btnPick");
    const btnCopyAll = document.getElementById("btnCopyAll");
    const btnReset   = document.getElementById("btnReset");
    const btnTheme   = document.getElementById("btnTheme");
    const btnSort    = document.getElementById("btnSort");
    const sortArea   = document.getElementById("sortArea");

    const inpName    = document.getElementById("inpName");
    const inpBirth   = document.getElementById("inpBirth");
    const inpTime    = document.getElementById("inpTime");
    const inpKeyword = document.getElementById("inpKeyword");

    const txtTitle      = document.getElementById("txtTitle");
    const txtSub        = document.getElementById("txtSub");
    const txtBadge      = document.getElementById("txtBadge");
    
    const txtBtnPick    = document.getElementById("txtBtnPick");
    const txtBtnCopy    = document.getElementById("txtBtnCopy");
    const txtBtnReset   = document.getElementById("txtBtnReset");
    
    const txtHeroTitle  = document.getElementById("txtHeroTitle");
    const txtHeroSub    = document.getElementById("txtHeroSub");

    const mascotImg  = document.getElementById("mascot");

    const savedTheme = localStorage.getItem("theme");
    const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    let isDark = savedTheme === "dark" || (!savedTheme && systemDark);

    const TEXTS = {
      light: {
        title: "ğŸ€ ì•¼ì˜¹ì´ ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ",
        sub: "ê°„ë‹¨ ì •ë³´ ë„£ìœ¼ë©´ ê·¸ ê¸°ìš´(?)ìœ¼ë¡œ ë²ˆí˜¸ë¥¼ ë½‘ì•„ì¤€ë‹¤ëƒ¥ ğŸ¾<br/>ë‹¹ì‹ ë§Œì„ ìœ„í•œ ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸ë¥¼ í™•ì¸í•´ë³´ë¼ëƒ¥!",
        badge: "ì¬ë¯¸ìš©ì´ëƒ¥",
        bPick: "ì‚¬ì£¼ ê¸°ìš´ìœ¼ë¡œ ë²ˆí˜¸ ë½‘ê¸°",
        bCopy: "ì „ì²´ ë³µì‚¬",
        bReset:"ì´ˆê¸°í™”",
        heroT: "ì•¼ì˜¹ì´ê°€ ë½‘ì•„ì¤€ ë²ˆí˜¸ë‹¤ëƒ¥ ğŸ",
        heroS: "ì„¸íŠ¸ë³„ <b>ë³µì‚¬</b>ë„ ë˜ê³ , <b>ì „ì²´ ë³µì‚¬</b>ë„ ëœë‹¤ëƒ¥!",
        inpNamePh: "ì˜ˆ) ì•¼ì˜¹ì´",
        inpKeyPh: "ì˜ˆ) ê¸°ë¶„ ì¢‹ìŒ / ëŒ€ë°•",
        seedWait: "ê¸°ìš´: ëŒ€ê¸°ì¤‘ì´ëƒ¥",
        toastInit: "ì•„ì§ ë½‘ì€ ë²ˆí˜¸ê°€ ì—†ë‹¤ëƒ¥. ë²„íŠ¼ ëˆŒëŸ¬ë³´ë¼ëƒ¥!",
        toastPick: "ë¶„ì„ ì™„ë£Œ! í–‰ìš´ì˜ ê¸°ìš´ì„ ë‹´ì•„ ë½‘ì•˜ë‹¤ëƒ¥ ğŸ”®",
        toastRand: "ì •ë³´ê°€ ì—†ì–´ì„œ ì™„ì „ ëœë¤ìœ¼ë¡œ ë½‘ì•˜ë‹¤ëƒ¥ ğŸ²",
        toastCopy: "ì „ì²´ ë³µì‚¬ ì™„ë£Œë‹¤ëƒ¥ âœ…",
        toastReset: "ì´ˆê¸°í™”í–ˆë‹¤ëƒ¥. ë‹¤ì‹œ ë½‘ì•„ë³´ë¼ëƒ¥ ğŸ²",
        repTitle: "ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë¶„ì„",
        luckyMsgPre: "ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸ëŠ” ",
        luckyMsgPost: " ì´ë‹¤ëƒ¥! ê¼­ ì±™ê²¨ê°€ë¼ëƒ¥~"
      },
      dark: {
        title: "ğŸ· ëª½ë§ˆ ì•¼ì˜¹ì˜ ì€ë°€í•œ ì œì•ˆ",
        sub: "ë„ˆì˜ ì •ë³´ë¥¼ ì‚´ì§ ë„˜ê¸°ë©´... ì¹˜ëª…ì ì¸ ë²ˆí˜¸ë¥¼ ì†ì‚­ì—¬ì£¼ì§€ ğŸ’‹<br/>í”¼í•  ìˆ˜ ì—†ëŠ” ìš´ëª…ì˜ ë²ˆí˜¸ë¥¼ ë°›ì•„ë“¤ì—¬...",
        badge: "ì˜í˜¼ ê³„ì•½ ğŸ“œ",
        bPick: "ê¸ˆë‹¨ì˜ ë²ˆí˜¸ ì†Œí™˜í•˜ê¸°",
        bCopy: "ì „ë¶€ í›”ì¹˜ê¸°",
        bReset:"ê¸°ì–µ ì†Œê±°",
        heroT: "ì, ë„¤ê°€ ì›í•˜ë˜ ìš•ë§ ë©ì–´ë¦¬ì•¼... ğŸ˜ˆ",
        heroS: "ê°€ì ¸ê°€... í•˜ì§€ë§Œ <b>ë‹¹ì²¨</b>ë˜ë©´ ë‚˜ë¥¼ ìŠì§€ ë§ˆ... ğŸ·",
        inpNamePh: "ì˜ˆ) ê¸¸ ìƒì€ ì–´ë¦°ì–‘",
        inpKeyPh: "ì˜ˆ) ë¶€ê·€ì˜í™” / íƒ€ë½",
        seedWait: "ê³„ì•½: ëŒ€ê¸° ì¤‘...",
        toastInit: "ë§ì„¤ì´ì§€ ë§ˆ... ì–´ì„œ ê³„ì•½(ë²„íŠ¼)ì„ ì§„í–‰í•´...",
        toastPick: "ì¹˜ëª…ì ì¸ ìš´ëª…ì˜ ë²ˆí˜¸ë¥¼ ì†Œí™˜í–ˆì–´... ğŸ©¸",
        toastRand: "ê²ìŸì´êµ°... ë¬´ì‘ìœ„ ìš´ëª…ì— ë„ˆë¥¼ ë§¡ê¸´ë‹¤ ğŸŒ‘",
        toastCopy: "ì´ ë²ˆí˜¸ë¥¼ í›”ì³ê°€ëŠ”êµ°... ì¢‹ì•„, ë¹„ë°€ë¡œ í•´ì£¼ì§€.",
        toastReset: "ëª¨ë“  ê¸°ì–µì„ ì§€ì› ì–´... ë‹¤ì‹œ ì²˜ìŒë¶€í„° ìœ í˜¹í•´ë´.",
        repTitle: "ğŸ©¸ ìš´ëª… ê³„ì•½ì„œ",
        luckyMsgPre: "ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸ëŠ” ",
        luckyMsgPost: "... ìš´ëª…ì„ ë°”ê¿€ ì—´ì‡ ê°€ ë  ê±°ì•¼."
      }
    };

    function updateTheme() {
      const t = isDark ? TEXTS.dark : TEXTS.light;
      
      if (isDark) {
        document.body.classList.add("dark-mode");
        btnTheme.textContent = "â˜€ï¸";
        mascotImg.src = "./mascot_dark.png";
      } else {
        document.body.classList.remove("dark-mode");
        btnTheme.textContent = "ğŸŒ™";
        mascotImg.src = "./mascot_bright.png";
      }

      txtTitle.textContent = t.title;
      txtSub.innerHTML     = t.sub;
      txtBadge.textContent = t.badge;
      txtBtnPick.textContent    = t.bPick;
      txtBtnCopy.textContent    = t.bCopy;
      txtBtnReset.textContent   = t.bReset;
      txtHeroTitle.textContent  = t.heroT;
      txtHeroSub.innerHTML      = t.heroS;
      reportTitle.textContent   = t.repTitle;

      inpName.placeholder = t.inpNamePh;
      inpKeyword.placeholder = t.inpKeyPh;

      if (stampEl.textContent === "ëŒ€ê¸° ì¤‘") {
        seedInfoEl.textContent = t.seedWait;
        toastEl.textContent = t.toastInit;
      }

      localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    updateTheme();

    btnTheme.addEventListener("click", () => {
      isDark = !isDark;
      updateTheme();
      const rect = btnTheme.getBoundingClientRect();
      sparkleAt(rect.left + rect.width/2, rect.top + rect.height/2);
    });

    function setMascotFallback() {
      const bgColor = isDark ? "#1e293b" : "#fff7e6";
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="180" height="180" viewBox="0 0 180 180">
          <rect width="180" height="180" rx="34" fill="${bgColor}"/>
          <text x="50%" y="50%" font-size="24" text-anchor="middle" dy=".3em" fill="#888">
            ${isDark ? "Dark Img 404" : "Img 404"}
          </text>
        </svg>`;
      mascotImg.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg.trim());
    }
    mascotImg.addEventListener("error", setMascotFallback);

    // ============================================ 
    // ğŸ”® SajuEngine: Enhanced Fortune Logic
    // ============================================ 
    const SajuEngine = {
      GAN: ['ê°‘','ì„','ë³‘','ì •','ë¬´','ê¸°','ê²½','ì‹ ','ì„','ê³„'],
      JI:  ['ì','ì¶•','ì¸','ë¬˜','ì§„','ì‚¬','ì˜¤','ë¯¸','ì‹ ','ìœ ','ìˆ ','í•´'],
      
      DESC_GAN: {'ê°‘':'í°ë‚˜ë¬´','ì„':'ê½ƒ','ë³‘':'íƒœì–‘','ì •':'ì´›ë¶ˆ','ë¬´':'í°ì‚°','ê¸°':'ë°­','ê²½':'ë°”ìœ„','ì‹ ':'ë³´ì„','ì„':'ë°”ë‹¤','ê³„':'ë¹—ë¬¼'},
      DESC_JI:  {'ì':'ì¥','ì¶•':'ì†Œ','ì¸':'í˜¸ë‘ì´','ë¬˜':'í† ë¼','ì§„':'ìš©','ì‚¬':'ë±€','ì˜¤':'ë§','ë¯¸':'ì–‘','ì‹ ':'ì›ìˆ­ì´','ìœ ':'ë‹­','ìˆ ':'ê°œ','í•´':'ë¼ì§€'},

      ELEMENTS: {
        'ê°‘':'ëª©', 'ì„':'ëª©', 'ì¸':'ëª©', 'ë¬˜':'ëª©',
        'ë³‘':'í™”', 'ì •':'í™”', 'ì‚¬':'í™”', 'ì˜¤':'í™”',
        'ë¬´':'í† ', 'ê¸°':'í† ', 'ì§„':'í† ', 'ìˆ ':'í† ', 'ì¶•':'í† ', 'ë¯¸':'í† ',
        'ê²½':'ê¸ˆ', 'ì‹ ':'ê¸ˆ', 'ìœ ':'ê¸ˆ',
        'ì„':'ìˆ˜', 'ê³„':'ìˆ˜', 'í•´':'ìˆ˜', 'ì':'ìˆ˜'
      },

      EASY_DESC: {
        'ëª©': {
             'ëª©': {L:'ìš¸ì°½í•œ ìˆ²ì²˜ëŸ¼ ì¹œêµ¬ë“¤ê³¼ ì–´ìš¸ë¦¬ê¸° ì¢‹ì€ ë‚ ì´ë‹¤ëƒ¥! í•¨ê»˜í•˜ë©´ í–‰ìš´ì´ ë‘ ë°°!', D:'ìˆ²ì´ ë„ˆë¬´ ìš°ê±°ì ¸ ì•ì´ ì•ˆ ë³´ì¼ ìˆ˜ ìˆì–´. ê³ê°€ì§€ë¥¼ ì³ë‚´ê³  ë„¤ ê¸¸ì„ ê°€ë¼.'},
             'í™”': {L:'ë‚˜ë¬´ê°€ ë¶ˆì„ ë§Œë‚˜ í™œí™œ íƒ€ì˜¤ë¥¸ë‹¤ëƒ¥! ë‹¹ì‹ ì˜ ì—´ì •ì„ ë§˜ê» ë½ë‚¼ ê¸°íšŒ!', D:'ìì‹ ì„ íƒœì›Œ ë¹›ì„ ë‚´ëŠ” í˜•êµ­... ë„ˆë¬´ ë¬´ë¦¬í•˜ì§€ ë§ˆë¼. ì¬ê°€ ë  ìˆ˜ë„ ìˆë‹¤.'},
             'í† ': {L:'ë‚˜ë¬´ê°€ ë‹¨ë‹¨í•œ í™ì— ë¿Œë¦¬ë¥¼ ë‚´ë¦°ë‹¤ëƒ¥! ë…¸ë ¥í•œ ë§Œí¼ ê²°ì‹¤ì„ ë§ºëŠ” ë‚ !', D:'ë¿Œë¦¬ê°€ ë•…ì„ íŒŒí—¤ì¹˜ëŠ”êµ°. ë‚¨ì˜ ê²ƒì„ ì·¨í•´ì„œë¼ë„ ë„¤ ìë¦¬ë¥¼ ë§Œë“¤ì–´.'},
             'ê¸ˆ': {L:'ë„ë¼ë¡œ ë‚˜ë¬´ë¥¼ ë‹¤ë“¬ì–´ ë©‹ì§„ ê°€êµ¬ë¥¼ ë§Œë“ ë‹¤ëƒ¥! ì¡°ê¸ˆ í˜ë“¤ì–´ë„ ê²°ê³¼ëŠ” ëŒ€ë°•!', D:'ë‚ ì¹´ë¡œìš´ ì¹¼ë‚ ì´ ë„ˆë¥¼ ë…¸ë¦°ë‹¤. ë² ì´ì§€ ì•Šìœ¼ë ¤ë©´ ì •ì‹  ë°”ì§ ì°¨ë ¤ì•¼ í•´.'},
             'ìˆ˜': {L:'ëª©ë§ˆë¥¸ ë‚˜ë¬´ì— ë‹¨ë¹„ê°€ ë‚´ë¦°ë‹¤ëƒ¥! ê·€ì¸ì˜ ë„ì›€ìœ¼ë¡œ ì‘¥ì‘¥ ì„±ì¥í•˜ëŠ” ë‚ !', D:'ì°¨ê°€ìš´ ë¬¼ì´ ìŠ¤ë©°ë“ ë‹¤. ê¹Šì€ ì¹¨ë¬µ ì†ì—ì„œ ì§€í˜œë¥¼ ì–»ì„ ë•Œì•¼.'}
        },
        'í™”': {
             'ëª©': {L:'ë•”ê°ì„ ì–»ì€ ë¶ˆê½ƒì²˜ëŸ¼ ê¸°ìš´ì´ ì†Ÿì•„ë‚œë‹¤ëƒ¥! ìœ—ì‚¬ëŒì˜ ë•ì„ ë³¼ ìˆ˜ ìˆì–´.', D:'ëˆ„êµ°ê°€ ì¥ì‘ì„ ë˜ì ¸ì£¼ëŠ”êµ°. ê·¸ í˜ì„ ì´ìš©í•´ ë” ê±°ëŒ€í•˜ê²Œ íƒ€ì˜¬ë¼ë¼.'},
             'í™”': {L:'ë¶ˆê³¼ ë¶ˆì´ ë§Œë‚˜ íŒŒí‹° ë¶„ìœ„ê¸°ë‹¤ëƒ¥! ì˜¤ëŠ˜ì€ ì¦ê²ê²Œ ë†€ì•„ë³´ì!', D:'í™”ë§ˆê°€ ë®ì¹˜ëŠ” ê²©ì´ë‹¤. ë¶„ë…¸ë¥¼ ì¡°ì ˆí•˜ì§€ ëª»í•˜ë©´ ë‹¤ì¹  ìˆ˜ ìˆì–´.'},
             'í† ': {L:'ë”°ëœ»í•œ ë¶ˆì´ í™ì„ ê°ì‹¸ì¤€ë‹¤ëƒ¥. ë² í‘¸ëŠ” ë§Œí¼ ë³µì´ ëŒì•„ì˜¤ëŠ” ë‚ !', D:'ëª¨ë“  ê±¸ íƒœìš°ê³  í™ìœ¼ë¡œ ëŒì•„ê°ˆ í…ê°€? í—ˆë¬´í•¨ì„ ê²½ê³„í•´.'},
             'ê¸ˆ': {L:'ë¶ˆë¡œ ê¸ˆì„ ë…¹ì—¬ ë³´ì„ì„ ë§Œë“ ë‹¤ëƒ¥! ë‹¹ì‹ ì˜ ëŠ¥ë ¥ìœ¼ë¡œ ëˆì„ ë²„ëŠ” ë‚ !', D:'ì‡ ë¥¼ ë…¹ì´ëŠ” ê³ í†µì„ ê²¬ëŒë¼. ê·¸ ëì—” ë‹¬ì½¤í•œ ë³´ìƒì´ ê¸°ë‹¤ë¦°ë‹¤.'},
             'ìˆ˜': {L:'ë¶ˆì´ ë„ˆë¬´ ëœ¨ê±°ìš¸ ë• ë¬¼ë¡œ ì‹í˜€ì•¼ í•œë‹¤ëƒ¥. ì ì‹œ ì‰¬ì–´ê°€ëŠ” ì§€í˜œê°€ í•„ìš”í•´.', D:'ì°¨ê°€ìš´ í˜„ì‹¤ì´ ë„ˆì˜ ì—´ì •ì„ êº¼ëœ¨ë¦¬ë ¤ í•œë‹¤. ë¶ˆì”¨ë¥¼ ì§€ì¼œë‚´.'}
        },
        'í† ': {
             'ëª©': {L:'í™ì— ë‚˜ë¬´ë¥¼ ì‹¬ëŠ” ë‚ ! ì±…ì„ê°ì´ ë¬´ê²ì§€ë§Œ ë³´ëŒì°° ê±°ì•¼.', D:'ëˆ„êµ°ê°€ ë„¤ ì˜ì—­ì„ ì¹¨ë²”í•˜ë ¤ í•œë‹¤. ëºê¸°ì§€ ì•Šê²Œ ê²½ê³„ë¥¼ ëŠ¦ì¶”ì§€ ë§ˆ.'},
             'í™”': {L:'ë”°ëœ»í•œ í–‡ì‚´ì„ ë°›ì€ í™ì´ë‹¤ëƒ¥! ì‚¬ë‘ê³¼ ì¸ì •ì„ ë“¬ë¿ ë°›ëŠ” í•˜ë£¨!', D:'ëœ¨ê±°ìš´ ì—´ê¸°ê°€ ë•…ì„ ë©”ë§ˆë¥´ê²Œ í•œë‹¤. ê°ˆì¦ì„ í•´ì†Œí•  ë°©ë²•ì„ ì°¾ì•„.'},
             'í† ': {L:'ì‚° ë„˜ì–´ ì‚°! ë“ ë“ í•œ ë™ë£Œì™€ í•¨ê»˜ë¼ë©´ ë‘ë ¤ìš¸ ê²Œ ì—†ë‹¤ëƒ¥.', D:'ì²©ì²©ì‚°ì¤‘... ê³ ì§‘ì„ ë¶€ë¦¬ë©´ ê³ ë¦½ë  ìˆ˜ ìˆì–´. ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•´.'},
             'ê¸ˆ': {L:'í™ ì†ì—ì„œ ê¸ˆì„ ìºë‚´ëŠ” ë‚ ! íš¡ì¬ìˆ˜ê°€ ìˆìœ¼ë‹ˆ ì£¼ìœ„ë¥¼ ì˜ ì‚´í´ë´!', D:'ë„¤ ì•ˆì˜ ìš•ë§ì„ êº¼ë‚´ë¼. ìˆ¨ê²¨ì§„ ë³´ë¬¼ì´ ë¹›ì„ ë³¼ ì‹œê°„ì´ë‹¤.'},
             'ìˆ˜': {L:'í™ìœ¼ë¡œ íŠ¼íŠ¼í•œ ëŒì„ ë§Œë“ ë‹¤ëƒ¥! ìƒˆì–´ë‚˜ê°€ëŠ” ëˆì„ ê½‰ ì¡ì„ ìˆ˜ ìˆì–´.', D:'íë¥´ëŠ” ë¬¼ì„ ì–µì§€ë¡œ ë§‰ìœ¼ë ¤ë‹¤ê°„ ë‘‘ì´ í„°ì§ˆ ìˆ˜ ìˆì–´. ì¡°ì‹¬í•´.'}
        },
        'ê¸ˆ': {
             'ëª©': {L:'ë„ë¼ë¡œ ë‚˜ë¬´ë¥¼ ë‹¤ë“¬ì–´ ì„±ê³¼ë¥¼ ë‚¸ë‹¤ëƒ¥! ì¼í•œ ë§Œí¼ í™•ì‹¤í•œ ë³´ìƒì´!', D:'ê°€ì°¨ ì—†ì´ ì˜ë¼ë‚´ë¼. ê°ì •ì— íœ˜ë‘˜ë¦¬ë©´ ê¸°íšŒë¥¼ ë†“ì¹  ê±°ì•¼.'},
             'í™”': {L:'ë¶ˆì— ë‹¨ë ¨ë˜ëŠ” ê°•ì² ì´ë‹¤ëƒ¥! ì‹œë ¨ì„ ê²ªì„ìˆ˜ë¡ ë” ë¹›ë‚˜ëŠ” ë²•!', D:'ëœ¨ê±°ìš´ ë¶ˆê¸¸ ì†ì— ë˜ì ¸ì¡Œë‹¤. ë…¹ì•„ë‚´ë¦´ì§€, ëª…ê²€ì´ ë ì§€ëŠ” ë„ˆì—ê²Œ ë‹¬ë ¸ì–´.'},
             'í† ': {L:'ê´‘ì‚°ì—ì„œ ìºë‚¸ ê·€í•œ ë³´ì„ì´ë‹¤ëƒ¥! ì–´ë””ì„œë‚˜ ì£¼ëª©ë°›ëŠ” ì¸ê¸°ìŸì´!', D:'ì–´ë‘  ì†ì—ì„œ ì€ë°€í•˜ê²Œ ë¹›ë‚˜ëŠ” ì¡´ì¬ê°... ì¡°ìš©íˆ ì‹¤ì†ì„ ì±™ê²¨.'},
             'ê¸ˆ': {L:'ë³´ì„ë¼ë¦¬ ë¶€ë”ªí˜€ ì§¤ë‘ê±°ë¦°ë‹¤ëƒ¥! ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤ ë–¨ê¸° ì¢‹ì€ ë‚ !', D:'ë‚ ì¹´ë¡œìš´ ì¹¼ê³¼ ì¹¼ì˜ ëŒ€ê²°. í”¼ë¥¼ ë³´ì§€ ì•Šìœ¼ë ¤ë©´ í•œë°œ ë¬¼ëŸ¬ì„œ.'},
             'ìˆ˜': {L:'ë§‘ì€ ë¬¼ì— ì”»ê¸´ ë³´ì„ì²˜ëŸ¼ ë°˜ì§ì¸ë‹¤ëƒ¥! ë‹¹ì‹ ì˜ ë§¤ë ¥ì´ ë‹ë³´ì´ëŠ” ë‚ !', D:'ì°¨ê°‘ê²Œ ì‹ì€ ì¹¼ë‚ ... ëƒ‰ì² í•œ íŒë‹¨ë§Œì´ ë„ˆë¥¼ êµ¬ì›í•  ê±°ì•¼.'}
        },
        'ìˆ˜': {
             'ëª©': {L:'ë‚˜ë¬´ì— ë¬¼ì„ ì£¼ëŠ” ë³´ëŒì°¬ í•˜ë£¨ë‹¤ëƒ¥! ë² í‘¸ëŠ” ê¸°ì¨ì„ ëŠê»´ë´.', D:'ë„¤ ê¸°ìš´ì´ ì‰´ ìƒˆ ì—†ì´ ë¹ ì ¸ë‚˜ê°„ë‹¤. ë‚¨ ì¢‹ì€ ì¼ë§Œ ì‹œí‚¤ì§€ ë§ˆ.'},
             'í™”': {L:'ë¬¼ë¡œ ë¶ˆì„ ë„ëŠ” í•´ê²°ì‚¬ë‹¤ëƒ¥! ì–´ë ¤ìš´ ë¬¸ì œë„ ì²™ì²™ í•´ê²°!', D:'í­ì£¼í•˜ëŠ” ìƒí™©ì„ ì œì••í•´ë¼. ë„ˆë§Œì´ ì´ ë‚œì¥íŒì„ ëë‚¼ ìˆ˜ ìˆì–´.'},
             'í† ': {L:'ë¬¼ê¸¸ì„ ë§‰ëŠ” ëŒì„ ë§Œë‚¬ë‹¤ëƒ¥. ë‹µë‹µí•´ë„ ì ì‹œ íë¦„ì„ ë©ˆì¶”ê³  ìƒê°í•´ë³´ì.', D:'íë¥´ì§€ ëª»í•˜ë©´ ì©ëŠ” ë²•. ë§‰íŒ ê³³ì„ ëš«ì„ ìš°íšŒë¡œë¥¼ ì°¾ì•„ë‚´.'},
             'ê¸ˆ': {L:'ë°”ìœ„ í‹ˆì—ì„œ ì†Ÿì•„ë‚˜ëŠ” ë§‘ì€ ìƒ˜ë¬¼! ì•„ì´ë””ì–´ê°€ ì½¸ì½¸ ìŸì•„ì§„ë‹¤ëƒ¥!', D:'ë‚ ì¹´ë¡œìš´ ì§€ì„±ì´ ë„ˆë¥¼ ë•ëŠ”ë‹¤. ì°¨ê°‘ê³  ì˜ˆë¦¬í•˜ê²Œ ë¶„ì„í•´.'},
             'ìˆ˜': {L:'í° ê°•ë¬¼ì´ ë˜ì–´ ë°”ë‹¤ë¡œ í˜ëŸ¬ê°„ë‹¤ëƒ¥! ë” ë„“ì€ ì„¸ìƒìœ¼ë¡œ ë‚˜ì•„ê°ˆ ê¸°íšŒ!', D:'ì‹¬ì—°ì„ ë“¤ì—¬ë‹¤ë³´ëŠ” ë‚ ... ë„ˆ ìì‹ ì˜ ì–´ë‘ ì„ ë§ˆì£¼í•˜ê³  ë°›ì•„ë“¤ì—¬.'}
        }
      },

      LUCKY_MAP: {
        'ëª©': [5, 10, 15, 20, 25, 30, 35, 40, 45],
        'í™”': [4, 9, 14, 19, 24, 29, 34, 39, 44],
        'í† ': [1, 6, 11, 16, 21, 26, 31, 36, 41],
        'ê¸ˆ': [3, 8, 13, 18, 23, 28, 33, 38, 43],
        'ìˆ˜': [2, 7, 12, 17, 22, 27, 32, 37, 42]
      },

      getGanji(y, m, d) {
        let yearVal = y;
        if (m < 2 || (m === 2 && d < 4)) yearVal = y - 1;
        const yearIdx = (yearVal - 4) % 60;
        const yearGan = this.GAN[yearIdx % 10];
        const yearJi  = this.JI[yearIdx % 12];

        const dayGanIdx = (Math.floor((new Date(y, m-1, d) - new Date(1900, 0, 1)) / 86400000) + 0) % 10;
        const dayJiIdx  = (Math.floor((new Date(y, m-1, d) - new Date(1900, 0, 1)) / 86400000) + 10) % 12;
        
        const dGan = this.GAN[(dayGanIdx + 100000) % 10];
        const dJi  = this.JI[(dayJiIdx + 100000) % 12];
        const dElem = this.getElement(dGan);

        return {
          year: `${yearGan}${yearJi}`,
          dayGan: dGan,
          dayJi: dJi,
          dayElement: dElem,
          desc: `${dGan}(${this.DESC_GAN[dGan]}/${dElem})`
        };
      },
      
      getTimeElement(dayGan, hour) {
          if (!hour && hour !== 0) return null;
          const h = parseInt(hour);
          const ganIdxMap = {'ê°‘':0, 'ì„':1, 'ë³‘':2, 'ì •':3, 'ë¬´':4, 'ê¸°':5, 'ê²½':6, 'ì‹ ':7, 'ì„':8, 'ê³„':9};
          const baseIdx = ganIdxMap[dayGan];
          const offset = (baseIdx % 5) * 2;
          
          let timeBranchIdx = 0;
          if (h >= 23 || h < 1) timeBranchIdx = 0;
          else timeBranchIdx = Math.floor((h - 1) / 2) + 1;
          
          const timeGanIdx = (offset + timeBranchIdx) % 10;
          const tGan = this.GAN[timeGanIdx];
          return this.getElement(tGan);
      },

      getElement(char) {
        if (char === 'ì‹ ') return 'ê¸ˆ'; 
        return this.ELEMENTS[char] || 'í† ';
      },

      analyze(myElem, todayElem, timeElem = null) {
        const relations = {
          'ëª©': { 'ëª©':'ë¹„ê²¬', 'í™”':'ì‹ìƒ', 'í† ':'ì¬ì„±', 'ê¸ˆ':'ê´€ì„±', 'ìˆ˜':'ì¸ì„±' },
          'í™”': { 'ëª©':'ì¸ì„±', 'í™”':'ë¹„ê²¬', 'í† ':'ì‹ìƒ', 'ê¸ˆ':'ì¬ì„±', 'ìˆ˜':'ê´€ì„±' },
          'í† ': { 'ëª©':'ê´€ì„±', 'í™”':'ì¸ì„±', 'í† ':'ë¹„ê²¬', 'ê¸ˆ':'ì‹ìƒ', 'ìˆ˜':'ì¬ì„±' },
          'ê¸ˆ': { 'ëª©':'ì¬ì„±', 'í™”':'ê´€ì„±', 'í† ':'ì¸ì„±', 'ê¸ˆ':'ë¹„ê²¬', 'ìˆ˜':'ì‹ìƒ' },
          'ìˆ˜': { 'ëª©':'ì‹ìƒ', 'í™”':'ì¬ì„±', 'í† ':'ê´€ì„±', 'ê¸ˆ':'ì¸ì„±', 'ìˆ˜':'ë¹„ê²¬' }
        };

        const rel = relations[myElem][todayElem];
        let timeBonus = 0;
        if (timeElem) {
            const timeRel = relations[myElem][timeElem];
            if (timeRel === 'ë¹„ê²¬' || timeRel === 'ì¸ì„±') timeBonus = 5;
            else if (timeRel === 'ì¬ì„±') timeBonus = 3;
        }

        const TEXT_DB = {
            'ë¹„ê²¬': {
                score: 60,
                totalL: "ì¹œêµ¬ë“¤ê³¼ ì–´ìš¸ë¦¬ê¸° ì¢‹ì€ ë‚ ! ê²½ìŸë³´ë‹¨ í˜‘ë ¥ì´ ì¢‹ë‹¤ëƒ¥.",
                totalD: "ë¼ì´ë²Œì´ ë“±ì¥í–ˆêµ°. ë°Ÿê³  ì˜¬ë¼ì„¤ ì¤€ë¹„ë‚˜ í•´.",
                moneyL: "ëˆì´ ë‚˜ê°€ê¸° ì‰¬ìš°ë‹ˆ ì§€ê°‘ ì¡°ì‹¬! ë”ì¹˜í˜ì´ ì¶”ì²œ.",
                moneyD: "ìš•ì‹¬ ë¶€ë¦¬ë‹¤ ëºê¸¸ ìˆ˜ ìˆë‹¤. ë‚´ ê²ƒì€ ë‚´ê°€ ì§€ì¼œ."
            },
            'ì‹ìƒ': {
                score: 85,
                totalL: "ì•„ì´ë””ì–´ê°€ ë¿œë¿œ! ë­ë“  ì‹œì‘í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì´ëƒ¥!",
                totalD: "ë„¤ ì¬ëŠ¥ì´ ë¹›ì„ ë°œí•˜ëŠ”êµ°... ì‚¬ëŒë“¤ì„ í™€ë ¤ë´.",
                moneyL: "ì¬ì£¼ ë¶€ë ¤ì„œ ëˆ ë²„ëŠ” ë‚ ! ì—´ì‹¬íˆ ì›€ì§ì—¬ë³´ë¼ëƒ¥.",
                moneyD: "ë„ˆì˜ ë§¤ë ¥ ìì²´ê°€ ëˆì´ ëœë‹¤. íŒì„ ê¹”ì•„ì£¼ì§€."
            },
            'ì¬ì„±': {
                score: 95,
                totalL: "ê²°ê³¼ë¬¼ì´ í™•ì‹¤í•œ ë‚ ! ë…¸ë ¥í•œ ë§Œí¼ ë³´ìƒ ë°›ëŠ”ë‹¤ëƒ¥!",
                totalD: "ëª¨ë“  ê²ƒì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ë‚ ... ìš•ë§ì„ ìˆ¨ê¸°ì§€ ë§ˆ.",
                moneyL: "ğŸ’° ê¸ˆì „ìš´ ìµœìƒ! ë¡œë˜ ì‚¬ëŸ¬ ê°€ê¸° ë”±ì´ë‹¤ëƒ¥!",
                moneyD: "ëˆ ëƒ„ìƒˆê°€ ì§„ë™í•˜ëŠ”êµ°. ì‹¹ ë‹¤ ê¸ì–´ëª¨ì•„."
            },
            'ê´€ì„±': {
                score: 45,
                totalL: "ì¡°ê¸ˆ ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ì¼ì´ ìƒê¸¸ìˆ˜ë„... ì°¨ë¶„í•˜ê²Œ ëŒ€ì²˜í•˜ìëƒ¥.",
                totalD: "ì„¸ìƒì´ ë„ˆë¥¼ ì–µì••í•˜ë ¤ ë“œëŠ”êµ°. ìˆ¨ ì£½ì´ê³  ê¸°ë‹¤ë ¤.",
                moneyL: "ì¶©ë™êµ¬ë§¤ ê¸ˆì§€! ì˜¤ëŠ˜ì€ ì•„ë¼ëŠ” ê²Œ ë²„ëŠ” ê±°ë‹¤ëƒ¥.",
                moneyD: "ëŒ€ê°€ ì—†ëŠ” ì´ë“ì€ ì—†ë‹¤. í•¨ë¶€ë¡œ ì†ëŒ€ì§€ ë§ˆ."
            },
            'ì¸ì„±': {
                score: 90,
                totalL: "ê·€ì¸ì´ ë•ëŠ” ë‚ ! ê°€ë§Œíˆ ìˆì–´ë„ ë–¡ì´ ìƒê¸´ë‹¤ëƒ¥?",
                totalD: "ì–´ë‘ ì˜ ì¡°ë ¥ìê°€ ìˆë‹¤. ê³„ì•½í•˜ê¸° ì¢‹ì€ ë‚ ì´ì•¼.",
                moneyL: "ë¬¸ì„œìš´ì´ ì¢‹ë‹¤ëƒ¥! ë³µê¶Œì´ë‚˜ ì£¼ì‹ë„ ê´œì°®ì„ì§€ë„?",
                moneyD: "í° ê·¸ë¦¼ì„ ê·¸ë ¤ë¼. ë‹¹ì¥ì˜ í˜„ê¸ˆë³´ë‹¤ ë¯¸ë˜ ê°€ì¹˜ì•¼."
            }
        };

        const t = TEXT_DB[rel];
        const easyDesc = this.EASY_DESC[myElem][todayElem];
        const finalScore = t.score + timeBonus; 
        
        const cand = this.LUCKY_MAP[myElem];
        const todayCode = new Date().getDate();
        const myCode = myElem.charCodeAt(0);
        const luckyNum = cand[(todayCode + myCode) % cand.length];

        return {
          relation: rel,
          score: Math.min(100, Math.max(0, finalScore)),
          luckyNum: luckyNum,
          light: { total: t.totalL, money: t.moneyL, desc: easyDesc.L },
          dark:  { total: t.totalD, money: t.moneyD, desc: easyDesc.D }
        };
      }
    };
    // ============================================ 

    let currentSets = [];

    function xmur3(str) {
      let h = 1779033703 ^ str.length;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return function() {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        h ^= h >>> 16;
        return h >>> 0;
      };
    }

    function mulberry32(seed) {
      let a = seed >>> 0;
      return function() {
        a |= 0;
        a = (a + 0x6D2B79F5) | 0;
        let t = Math.imul(a ^ (a >>> 15), 1 | a);
        t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    function buildSeedString() {
      const name = (inpName.value || "").trim();
      const birth = (inpBirth.value || "").trim();
      const time = (inpTime.value || "").trim();
      const key = (inpKeyword.value || "").trim();
      
      const now = new Date();
      const todayStr = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;

      if (!name && !birth && !key) return null;
      return `name=${name}|birth=${birth}|time=${time}|key=${key}|date=${todayStr}`;
    }

    function pickFiveSetsWithSeed(seed, luckyNum = null) {
      const out = [];
      for (let i=0;i<5;i++){
        const rng = mulberry32((seed + i * 0x9E3779B9) >>> 0);
        const set = new Set();
        if (luckyNum) set.add(luckyNum); 
        while (set.size < 6) {
          const n = Math.floor(rng() * 45) + 1;
          set.add(n);
        }
        out.push([...set].sort((a,b)=>a-b));
      }
      return out;
    }

    function pickFiveSetsRandom() {
      const out = [];
      for (let i=0;i<5;i++){
        const rng = () => Math.random();
        out.push(pickOneSetRandom(rng));
      }
      return out;
    }
    
    function pickOneSetRandom(rng) {
        const set = new Set();
        while (set.size < 6) {
          const n = Math.floor(rng() * 45) + 1;
          set.add(n);
        }
        return [...set].sort((a,b)=>a-b);
    }

    function rangeClass(n) {
      if (n <= 10) return "r1";
      if (n <= 20) return "r2";
      if (n <= 30) return "r3";
      if (n <= 40) return "r4";
      return "r5";
    }

    function nowStamp() {
      const d = new Date();
      const pad = (x) => String(x).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    function setToast(msg) { toastEl.textContent = msg; }

    function sparkleAt(x, y) {
      for (let i=0;i<10;i++){
        const s = document.createElement("div");
        s.className = "spark";
        const dx = (Math.random()*2-1) * 70;
        const dy = (Math.random()*2-1) * 70;
        s.style.left = x + "px";
        s.style.top  = y + "px";
        s.style.setProperty("--dx", dx + "px");
        s.style.setProperty("--dy", dy + "px");
        document.body.appendChild(s);
        s.addEventListener("animationend", ()=> s.remove());
      }
    }

    async function copyText(text) {
      try { await navigator.clipboard.writeText(text); return true; } 
      catch { return false; }
    }

    function renderSets(sets, luckyNum = null, baseScore = 0) {
      setsEl.innerHTML = "";
      sets.forEach((nums, idx) => {
        const card = document.createElement("div");
        card.className = "set-card";
        card.dataset.idx = idx; 

        const badge = document.createElement("div");
        badge.className = "rank-badge";
        card.appendChild(badge);

        const top = document.createElement("div");
        top.className = "set-top";

        const label = document.createElement("div");
        label.className = "set-label";
        label.innerHTML = `Set ${idx+1} <span class="pill">${nums.join("-")}</span>`;

        const btn = document.createElement("button");
        btn.className = "mini-btn";
        btn.type = "button";
        btn.innerHTML = "ğŸ“‹";
        btn.addEventListener("click", async (e) => {
          const ok = await copyText(nums.join(", "));
          if (ok) setToast(`ë³µì‚¬ ì™„ë£Œ âœ… (Set ${idx+1})`);
          else setToast("ë³µì‚¬ ì‹¤íŒ¨... ê¶Œí•œì„ í™•ì¸í•´.");
          const rect = e.currentTarget.getBoundingClientRect();
          sparkleAt(rect.left + rect.width/2, rect.top + rect.height/2);
        });

        top.appendChild(label);
        top.appendChild(btn);

        const balls = document.createElement("div");
        balls.className = "balls";

        // Score Sync Logic: Base Score +/- 5
        // Use set numbers sum to create deterministic variation
        const variation = (nums.reduce((a,b)=>a+b,0) % 11) - 5; // -5 to +5
        const setScore = Math.min(100, Math.max(0, baseScore + variation));
        
        card.dataset.score = setScore;

        nums.forEach((n, j) => {
          const b = document.createElement("div");
          b.className = `ball ${rangeClass(n)}`;
          if (luckyNum && n === luckyNum) b.classList.add("lucky"); 
          b.textContent = n;
          b.style.setProperty("--d", `${(idx*60) + (j*70)}ms`);
          requestAnimationFrame(() => b.classList.add("show"));
          balls.appendChild(b);
        });

        card.appendChild(top);
        card.appendChild(balls);
        setsEl.appendChild(card);
      });
      
      btnSort.textContent = "ğŸ† ê¸°ìš´ìˆœ ì •ë ¬ (TOP 5)";
      btnSort.disabled = false;
    }

    function setLoading(on) {
      if (on) btnPick.classList.add("loading");
      else btnPick.classList.remove("loading");
    }

    btnSort.addEventListener("click", () => {
        const cards = Array.from(setsEl.children);
        cards.sort((a, b) => Number(b.dataset.score) - Number(a.dataset.score));
        
        setsEl.innerHTML = "";
        cards.forEach((card, i) => {
            card.classList.remove("rank-1", "rank-2", "rank-3");
            const badge = card.querySelector(".rank-badge");
            badge.style.display = "none"; 
            
            const score = card.dataset.score;

            if (i === 0) {
                card.classList.add("rank-1");
                badge.innerHTML = `ğŸ‘‘ TOP 1<span class="rank-score">ì˜¤í–‰ì ìˆ˜: ${score}</span>`;
                badge.style.display = "block";
            }
            if (i === 1) {
                card.classList.add("rank-2");
                badge.innerHTML = `ğŸ¥ˆ TOP 2<span class="rank-score">ì˜¤í–‰ì ìˆ˜: ${score}</span>`;
                badge.style.display = "block";
            }
            if (i === 2) {
                card.classList.add("rank-3");
                badge.innerHTML = `ğŸ¥‰ TOP 3<span class="rank-score">ì˜¤í–‰ì ìˆ˜: ${score}</span>`;
                badge.style.display = "block";
            }
            setsEl.appendChild(card);
        });
        
        btnSort.textContent = "âœ¨ ì •ë ¬ ì™„ë£Œ!";
        btnSort.disabled = true;
    });

    btnPick.addEventListener("click", async (e) => {
      setLoading(true);
      const rect = e.currentTarget.getBoundingClientRect();
      sparkleAt(rect.left + rect.width/2, rect.top + rect.height/2);

      await new Promise(r => setTimeout(r, 600));

      const name = inpName.value.trim();
      const birth = inpBirth.value; 
      const time = inpTime.value; 
      const key = inpKeyword.value.trim();
      const seedStr = buildSeedString();
      const t = isDark ? TEXTS.dark : TEXTS.light;
      
      let luckyNum = null;
      let baseScore = 50; // default

      if (name && birth) {
        const [by, bm, bd] = birth.split('-').map(Number);
        const mySaju = SajuEngine.getGanji(by, bm, bd);
        const now = new Date();
        const todaySaju = SajuEngine.getGanji(now.getFullYear(), now.getMonth()+1, now.getDate());
        
        const myTimeElem = SajuEngine.getTimeElement(mySaju.dayGan, time);
        const result = SajuEngine.analyze(mySaju.dayElement, todaySaju.dayElement, myTimeElem);
        luckyNum = result.luckyNum;
        baseScore = result.score;

        const finalSeedStr = `${seedStr}|score=${result.score}`;
        const seedFn = xmur3(finalSeedStr);
        const seed32 = seedFn();
        
        currentSets = pickFiveSetsWithSeed(seed32, luckyNum);

        const info = isDark ? result.dark : result.light;
        reportTotal.textContent = info.total;
        reportMoney.textContent = info.money;
        reportScore.textContent = `${result.score}ì `;
        
        reportLuckyMsg.innerHTML = `${t.luckyMsgPre} <span class="lucky-ball">${luckyNum}</span> ${t.luckyMsgPost}`;
        
        reportSaju.innerHTML = `
            <span style="color:var(--sub)">ë‚˜:</span> <b>${mySaju.desc}</b><br/>
            <span style="color:var(--sub)">ì˜¤ëŠ˜:</span> <b>${todaySaju.desc}</b>
        `;
        sajuEasyDesc.textContent = info.desc; 
        
        reportCard.style.display = "flex";
        sortArea.style.display = "flex"; 

        const timeMsg = time ? " (ì‹œê°„ ë°˜ì˜ë¨)" : "";
        seedInfoEl.innerHTML = `ë¶„ì„ ì™„ë£Œ: <b>${name}</b>ë‹˜ì˜ ìš´ëª…ì  ë²ˆí˜¸${timeMsg}`;
        setToast(t.toastPick);

      } else if (seedStr) {
        const seedFn = xmur3(seedStr);
        const seed32 = seedFn();
        currentSets = pickFiveSetsWithSeed(seed32); 
        baseScore = seed32 % 100; // random score

        reportCard.style.display = "none";
        sortArea.style.display = "none";
        seedInfoEl.textContent = isDark ? "ê³„ì•½: ë¶ˆì™„ì „í•œ ì •ë³´..." : "ê¸°ìš´: ì •ë³´ê°€ ì¡°ê¸ˆ ë¶€ì¡±í•˜ë‹¤ëƒ¥!";
        setToast(t.toastPick);
      } else {
        currentSets = pickFiveSetsRandom();
        baseScore = Math.floor(Math.random()*100);
        
        reportCard.style.display = "none";
        sortArea.style.display = "none";
        seedInfoEl.textContent = isDark ? "ê³„ì•½: ë¬´ì‘ìœ„ ìš´ëª… ğŸ²" : "ê¸°ìš´: ëœë¤ì´ë‹¤ëƒ¥ ğŸ²";
        setToast(t.toastRand);
      }

      renderSets(currentSets, luckyNum, baseScore);
      stampEl.textContent = `Time: ${nowStamp()}`;
      setLoading(false);
    });

    // ... existing listeners ...
    btnCopyAll.addEventListener("click", async (e) => {
      const t = isDark ? TEXTS.dark : TEXTS.light;
      if (!currentSets.length) { setToast(t.toastInit); return; }
      const text = currentSets.map((s, i) => `ì„¸íŠ¸ ${i+1}: ${s.join(", ")}`).join("\n");
      const ok = await copyText(text);
      if (ok) setToast(t.toastCopy);
      else setToast("ë³µì‚¬ ì‹¤íŒ¨ ğŸ˜¿");
      const rect = e.currentTarget.getBoundingClientRect();
      sparkleAt(rect.left + rect.width/2, rect.top + rect.height/2);
    });

    btnReset.addEventListener("click", (e) => {
      const t = isDark ? TEXTS.dark : TEXTS.light;
      currentSets = [];
      setsEl.innerHTML = "";
      stampEl.textContent = "ëŒ€ê¸° ì¤‘";
      seedInfoEl.textContent = t.seedWait;
      reportCard.style.display = "none";
      sortArea.style.display = "none";
      setToast(t.toastReset);
      const rect = e.currentTarget.getBoundingClientRect();
      sparkleAt(rect.left + rect.width/2, rect.top + rect.height/2);
    });
  </script>
</body>
</html>